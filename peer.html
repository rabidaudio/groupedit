<html>
<head>
  <script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
  <script src="http://underscorejs.org/underscore.js"></script>
  <script src="http://cdn.peerjs.com/0.3/peer.js"></script>
  <script type='text/javascript' src='https://cdn.firebase.com/js/client/1.0.6/firebase.js'></script>
  <!--<script src="localstorage.js"></script>-->
  <script src="fbstorage.js"></script>
  <script src="comm.js"></script>
  <script type="text/javascript">
  
    var PEERJS_KEY = "j5i9gnkpwzxe0zfr";
    var room_name = "test";
    
    function send_update(){
        ge.send('data_update', $('#textarea').val() );
    }
    
    $(document).ready(function() {
        DB.init(room_name, function(data){
            ge.make_connections(data);
        });
        ge.init(PEERJS_KEY, room_name, function(me){
            ge.event.listen_for('message', function(data){
                console.log("message handler");
                console.log(data);
                 $('#helloworld').append(data);
            });
            ge.event.listen_for('data_update', function(data){
                console.log('data_update handler');
                console.log(data);
                $('#textarea').val(data);
            });
            console.log("Configured and ready!");
            $('#helloworld').append(navigator.userAgent+"<br>");
            $('#helloworld').append(me.id +"<br>");
            $(document.body).on('keydown', send_update);
            $('#test').click(function(){
                ge.send('message', "yo dawg, i'm "+me.id);
            });
        },true);//TODO debug
    });
  </script>
</head>

<body>
<div id="helloworld"></div>
<input type="button" id="test" value="test"></input>
<textarea id="textarea"></textarea>
</body>
</html>
